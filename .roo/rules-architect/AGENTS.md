# Project Architecture Rules (Non-Obvious Only)

## 系统架构约束
- **单类设计**: 所有功能集中在`BiliFavDownloader`类中，避免过度模块化
- **异步优先**: HTTP请求和文件下载使用异步模式，提高并发性能
- **状态管理**: 使用全局变量管理中断、文件覆盖等跨操作状态

## 数据流设计
- **API调用链**: 登录 → 获取收藏夹 → 获取视频信息 → 下载URL → 下载文件
- **缓存策略**: SQLite数据库缓存收藏夹数据，24小时自动更新检查
- **文件处理**: 下载队列 + 后台合并线程，确保下载和合并并行

## 扩展性考虑
- **清晰度支持**: 通过`QUALITY_MAP`配置支持多种清晰度，自动适配会员状态
- **格式兼容**: 同时支持DASH（高清晰度）和FLV（低清晰度）格式
- **错误恢复**: 中断后可继续，合并失败保留视频文件

## 部署架构
- **编译系统**: 自动版本递增和Nuitka打包，设置Windows文件属性
- **依赖管理**: uv包管理器配置中国镜像源，提高下载速度
- **环境要求**: 强制UTF-8编码，必需FFmpeg用于音视频处理